<div class="image-slider-section" style="max-width: 1000px; margin-left: auto; margin-right: auto;"
     data-autoplay="{{ section.settings.autoplay }}"
     data-autoplay-speed="{{ section.settings.autoplay_speed }}">
  {% if section.settings.heading != blank %}
    <h2 class="section-heading">{{ section.settings.heading }}</h2>
  {% endif %}

  <div class="image-slider">
    {% for block in section.blocks %}
      {% if block.type == 'slide' %}
        <div class="slide">
          {% if block.settings.image != blank %}
            <img src="{{ block.settings.image | img_url: 'master' }}" alt="{{ block.settings.image.alt | default: section.settings.heading }}">
          {% else %}
            <div class="placeholder-image">
              {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
            </div>
          {% endif %}
        </div>
      {% endif %}
    {% endfor %}
  </div> 

</div>

{% schema %}
{
  "name": "Image Slider with Heading",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Section Heading"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Enable Autoplay",
      "default": false
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "label": "Autoplay Speed (seconds)",
      "min": 2,
      "max": 10,
      "step": 1,
      "default": 5,
      "info": "The time each slide stays visible in seconds."
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Image Slider with Heading",
      "blocks": [
        { "type": "slide" },
        { "type": "slide" },
        { "type": "slide" }
      ]
    }
  ]
}
{% endschema %}

{% stylesheet %}
.image-slider-section {
  padding: 20px; /* Adjust padding as needed */
}

.section-heading {
  text-align: center;
  margin-bottom: 20px; /* Adjust spacing below heading */
}

.image-slider {
  overflow: hidden;
  position: relative;
}

.slide {
  width: 100%;
  flex-shrink: 0;
  display: none; /* Initially hide all slides */
}

.slide:first-child {
  display: block; /* Show the first slide */
}

.slide img {
  display: block;
  width: 100%;
  height: auto;
}

.placeholder-image {
  background-color: #f0f0f0;
  aspect-ratio: 16 / 9; /* You can adjust the aspect ratio */
  display: flex;
  justify-content: center;
  align-items: center;
  color: #ccc;
  font-size: 14px;
  text-align: center;
}

.slider-controls {
  position: absolute;
  top: 50%;
  left: 0;
  right: 0;
  transform: translateY(-50%);
  display: flex;
  justify-content: space-between;
  padding: 0 10px;
}

.slider-controls button {
  background: none;
  border: none;
  cursor: pointer;
  font-size: 24px; /* Adjust icon size */
  color: #333; /* Adjust icon color */
  padding: 5px;
}

.slider-controls button:focus {
  outline: none;
}
{% endstylesheet %}

{% javascript %}
document.addEventListener('DOMContentLoaded', function() {
  const sliderSections = document.querySelectorAll('.image-slider-section');

  sliderSections.forEach(section => {
    const slider = section.querySelector('.image-slider');
    const slides = section.querySelectorAll('.slide');
    const prevButton = section.querySelector('.prev-slide');
    const nextButton = section.querySelector('.next-slide');
    let currentIndex = 0;
    let autoplayInterval;

    function showSlide(index) {
      slides.forEach(slide => slide.style.display = 'none');
      slides[index].style.display = 'block';
    }

    function nextSlide() {
      currentIndex = (currentIndex + 1) % slides.length;
      showSlide(currentIndex);
    }

    function prevSlide() {
      currentIndex = (currentIndex - 1 + slides.length) % slides.length;
      showSlide(currentIndex);
    }

    function startAutoplay() {
      const autoplaySpeed = parseInt(section.dataset.autoplaySpeed) * 1000;
      autoplayInterval = setInterval(nextSlide, autoplaySpeed);
    }

    function stopAutoplay() {
      clearInterval(autoplayInterval);
    }

    if (slides.length > 0) {
      showSlide(currentIndex); // Show the initial slide

      if (nextButton && prevButton) {
        nextButton.addEventListener('click', () => {
          stopAutoplay();
          nextSlide();
        });
        prevButton.addEventListener('click', () => {
          stopAutoplay();
          prevSlide();
        });
      }

      const autoplayEnabled = section.dataset.autoplay === 'true';
      if (autoplayEnabled && slides.length > 1) {
        startAutoplay();
      }
    }
  });
});
{% endjavascript %}