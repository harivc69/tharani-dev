{% schema %}
{
  "name": "Custom Slider",
  "settings": [
    {
      "type": "range",
      "id": "slider_autoplay",
      "min": 0,
      "max": 10,
      "step": 1,
      "unit": "s",
      "label": "Autoplay (seconds)",
      "info": "Set to 0 to disable autoplay",
      "default": 5
    },
    {
      "type": "checkbox",
      "id": "show_dots",
      "label": "Show dots navigation",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_arrows",
      "label": "Show arrows navigation",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "limit": 6,
      "settings": [
        {
          "type": "image_picker",
          "id": "background_image",
          "label": "Background Image"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Slide Heading"
        },
        {
          "type": "text",
          "id": "subheading",
          "label": "Subheading",
          "default": "Slide Subheading"
        },
        {
          "type": "richtext",
          "id": "description",
          "label": "Description",
          "default": "<p>Add your description here</p>"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Button Text",
          "default": "Shop Now"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Button Link"
        },
        {
          "type": "select",
          "id": "text_alignment",
          "label": "Text Alignment",
          "options": [
            {
              "value": "custom_text_left",
              "label": "Left"
            },
            {
              "value": "custom_text_center",
              "label": "Center"
            },
            {
              "value": "custom_text_right",
              "label": "Right"
            }
          ],
          "default": "custom_text_center"
        },
        {
          "type": "color",
          "id": "text_color",
          "label": "Text Color",
          "default": "#ffffff"
        },
        {
          "type": "range",
          "id": "overlay_opacity",
          "min": 0,
          "max": 100,
          "step": 5,
          "unit": "%",
          "label": "Overlay Opacity",
          "default": 30
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Custom Slider",
      "blocks": [
        {
          "type": "slide"
        },
        {
          "type": "slide"
        }
      ]
    }
  ]
}
{% endschema %}

<div class="custom_slider_section">
  {% if section.blocks.size > 0 %}
    <div class="custom_slider_container" 
      data-autoplay="{{ section.settings.slider_autoplay }}" 
      data-show-dots="{{ section.settings.show_dots }}" 
      data-show-arrows="{{ section.settings.show_arrows }}">

      <div class="custom_slider">
        {% for block in section.blocks %}
          {% if block.type == 'slide' %}
            <div class="custom_slide {{ block.settings.text_alignment }}" {{ block.shopify_attributes }}>
              {% if block.settings.background_image %}
                <div class="custom_slide_bg">
                  <div class="custom_overlay" style="opacity: {{ block.settings.overlay_opacity | divided_by: 100.0 }};"></div>
                  {{ block.settings.background_image | image_url: width: 1800 | image_tag: loading: 'lazy', class: 'custom_bg_image' }}
                </div>
              {% endif %}
              
              <div class="custom_slide_content" style="color: {{ block.settings.text_color }}">
                {% if block.settings.heading != blank %}
                  <h2 class="custom_heading">{{ block.settings.heading }}</h2>
                {% endif %}
                
                {% if block.settings.subheading != blank %}
                  <h3 class="custom_subheading">{{ block.settings.subheading }}</h3>
                {% endif %}
                
                {% if block.settings.description != blank %}
                  <div class="custom_description">{{ block.settings.description }}</div>
                {% endif %}
                
                {% if block.settings.button_text != blank and block.settings.button_link != blank %}
                  <div class="custom_button_container">
                    <a href="{{ block.settings.button_link }}" class="custom_button">
                      {{ block.settings.button_text }}
                    </a>
                  </div>
                {% endif %}
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>

      {% if section.settings.show_arrows %}
        <button type="button" class="custom_arrow custom_arrow_prev" aria-label="Previous slide">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
        <button type="button" class="custom_arrow custom_arrow_next" aria-label="Next slide">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
      {% endif %}

      {% if section.settings.show_dots and section.blocks.size > 1 %}
        <div class="custom_dots">
          {% for block in section.blocks %}
            {% if block.type == 'slide' %}
              <button type="button" class="custom_dot{% if forloop.index0 == 0 %} custom_dot_active{% endif %}" aria-label="Go to slide {{ forloop.index }}"></button>
            {% endif %}
          {% endfor %}
        </div>
      {% endif %}
    </div>
  {% else %}
    <div class="custom_slider_placeholder">
      <p>Add slide blocks to display content</p>
    </div>
  {% endif %}
</div>

<style>
  .custom_slider_section {
    position: relative;
    width: 100%;
    overflow: hidden;
  }

  .custom_slider_container {
    position: relative;
  }

  .custom_slider {
    display: flex;
    transition: transform 0.5s ease;
  }

  .custom_slide {
    position: relative;
    flex: 0 0 100%;
    width: 100%;
    height: 80vh;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .custom_slide_bg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
  }

  .custom_bg_image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .custom_overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: #000;
    z-index: 2;
  }

  .custom_slide_content {
    position: relative;
    z-index: 3;
    padding: 30px;
    max-width: 800px;
    width: 100%;
  }

  .custom_text_left {
    text-align: left;
  }

  .custom_text_center {
    text-align: center;
  }

  .custom_text_right {
    text-align: right;
  }

  .custom_heading {
    margin: 0 0 15px;
    font-size: 18px;
    font-weight: 900;
    line-height: 1.2;
    color:white;
  }

  .custom_subheading {
    margin: 0 0 15px;
    font-size: 40px;
    font-weight: 400;
    line-height: 1;
    color:white;
  }

  .custom_description {
    margin: 0 0 20px;
    font-size: 16px;
    line-height: 1.6;
  }

  .custom_button_container {
    margin-top: 20px;
  }

  .custom_button {
    display: inline-block;
    padding: 12px 24px;
    background-color: #ffffff;
    color: #000000;
    font-size: 16px;
    text-decoration: none;
    border-radius: 4px;
    transition: all 0.3s ease;
  }

  .custom_button:hover {
    background-color: #f0f0f0;
  }

  .custom_arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 10;
    background: rgba(255, 255, 255, 0.8);
    border: none;
    border-radius: 50%;
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: #000;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  }

  .custom_arrow:hover {
    background: rgba(255, 255, 255, 1);
  }

  .custom_arrow_prev {
    left: 20px;
  }

  .custom_arrow_next {
    right: 20px;
  }

  .custom_dots {
    position: absolute;
    bottom: 20px;
    width: 100%;
    display: flex;
    justify-content: center;
    gap: 8px;
    z-index: 10;
  }

  .custom_dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.5);
    border: none;
    padding: 0;
    cursor: pointer;
  }

  .custom_dot_active {
    background: #ffffff;
  }

  .custom_slider_placeholder {
    padding: 100px 20px;
    text-align: center;
    background: #f0f0f0;
  }

  @media screen and (max-width: 768px) {
    .custom_slide {
      height: 400px;
    }
    
    .custom_heading {
      font-size: 32px;
    }
    
    .custom_subheading {
      font-size: 20px;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const sliderContainers = document.querySelectorAll('.custom_slider_container');
    
    sliderContainers.forEach(container => {
      const slider = container.querySelector('.custom_slider');
      const slides = container.querySelectorAll('.custom_slide');
      const dots = container.querySelectorAll('.custom_dot');
      const prevBtn = container.querySelector('.custom_arrow_prev');
      const nextBtn = container.querySelector('.custom_arrow_next');
      const autoplayTime = parseInt(container.dataset.autoplay, 10) * 1000;
      
      let currentIndex = 0;
      let autoplayInterval;
      
      function goToSlide(index) {
        if (index < 0) {
          index = slides.length - 1;
        } else if (index >= slides.length) {
          index = 0;
        }
        
        currentIndex = index;
        slider.style.transform = `translateX(-${currentIndex * 100}%)`;
        
        // Update dots
        dots.forEach((dot, i) => {
          dot.classList.toggle('custom_dot_active', i === currentIndex);
        });
      }
      
      function startAutoplay() {
        if (autoplayTime > 0) {
          autoplayInterval = setInterval(() => {
            goToSlide(currentIndex + 1);
          }, autoplayTime);
        }
      }
      
      function stopAutoplay() {
        clearInterval(autoplayInterval);
      }
      
      // Initialize
      if (slides.length > 0) {
        goToSlide(0);
        startAutoplay();
      }
      
      // Event listeners
      if (prevBtn) {
        prevBtn.addEventListener('click', () => {
          stopAutoplay();
          goToSlide(currentIndex - 1);
          startAutoplay();
        });
      }
      
      if (nextBtn) {
        nextBtn.addEventListener('click', () => {
          stopAutoplay();
          goToSlide(currentIndex + 1);
          startAutoplay();
        });
      }
      
      dots.forEach((dot, index) => {
        dot.addEventListener('click', () => {
          stopAutoplay();
          goToSlide(index);
          startAutoplay();
        });
      });
      
      // Touch/swipe support
      let touchStartX = 0;
      let touchEndX = 0;
      
      slider.addEventListener('touchstart', e => {
        touchStartX = e.changedTouches[0].screenX;
        stopAutoplay();
      }, {passive: true});
      
      slider.addEventListener('touchend', e => {
        touchEndX = e.changedTouches[0].screenX;
        
        if (touchStartX - touchEndX > 50) {
          // Swipe left
          goToSlide(currentIndex + 1);
        } else if (touchEndX - touchStartX > 50) {
          // Swipe right
          goToSlide(currentIndex - 1);
        }
        
        startAutoplay();
      }, {passive: true});
    });
  });
</script>